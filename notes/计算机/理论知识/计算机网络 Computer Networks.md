教材：计算机网络（清华第六版）
## 引言

### 网络的概念
自主计算机的互联集合

### 网络的分类

按拓扑结构
- 星型
- 总线型
- 环型
- 树型
- 网状：任一节点至少与其他两个节点直接相连
按用途
- 接入网
- 数据中心网DCN
	- 胖树网络
	- BCube网络
- 传输网
- 企业网
按地域规模
- 个域网PAN
- 局域网LAN
- 城域网MAN
- 广域网WAN
按网络技术
- 非交换网络
	- 点-点信道型网络
	- 共享信道型网络
- 交换网路
	电路交换
		空分交换
		时分交换
	报文交换（存储-转发技术）
	分组交换（包交换）
		把报文划分成若干大小相等的分组进行存储转发
		数据报Datagram：每个分组独立的寻找路径
			用户间通信不必建立连接
			每个分组独立找寻路径
			分组不一定按序到达
		虚电路Virtual  Circuit：任何分组发送前，建立一条逻辑连接，预先计划好路径
			用户通信必须建立连接
			分组按序到达
	混合交换
		同时采用电路交换和分组交换

### 网络核心的两大功能
- **路由**：
	- 全局操作：确定数据分组从源到目标所使用的路径
	- 需要路由协议和路由算法，产生路由表
- **转发**：
	- 本地操作：路由器或交换机将接收到的数据分组转发出去
	- 确定转发出去的接口/链路，通过查找本地路由表，根据从入接口收到的分组头中的目的地址确定出接口

### **协议与分层结构**
协议设计的目的
网络协议
	语法：规定传输数据的格式
	语义：规定所要完成的功能
	时序：规定各种操作的顺序

### 协议分层结构
- 层次栈：网络使用层次结构的协议栈，每一层都使用其下一层所提供的服务，并为上层提供自己的服务
- 对等实体：不同机器上构成相应层次的实体称为对等实体
- 接口：接口定义了下层向上层提供哪些服务原语
- 网络体系结构

协议分层的必要性

发送端：层层封装；接收端：层层解封装

#### **服务原语**

两种不同服务类型：面向连接和无连接
面向连接：按照电话系统模型建立的，每个请求或响应后，对方都产生一个确认动作
无连接：按照邮政系统模型建立的，邮件携带了完整的目标地址，传输过程不需要应答

服务：
典型服务：面向连接和无连接传输服务
服务由一组可用于用于进程以访问服务的原语形式指定
原语告诉服务执行某些操作或报告对等实体所采取的操作

六个核心服务原语
1. 连接请求
2. 接受响应
3. 请求数据
4. 应答
5. 请求断开
6. 断开连接

协议是水平的，服务是垂直的

**数据单元**
1. 协议数据单元 PDU
	在不同系统中的对等实体之间根据协议要求所交换的数据单元，可以理解为贴好快递单的整个包裹
2. 接口数据单元 IDU
	在同一系统中相邻两层实体经过层间接口所交换的数据单元
3. 服务数据单元 SDU
	本层实体为了完成服务用户请求所需要的数据单元，可以理解为快递包裹里的实际物品
4. 协议控制信息 PCI
	当前层为了完成本层功能而添加的控制信息
5. 接口控制信息 ICI
	这是在相邻两层之间通过服务访问点传递的控制信息，通常用于协调两层之间的操作。它不会随着数据一起传输到对端，只在本地有效

PDU = SDU + PCI   
IDU = PDU + ICI
![[Pasted image 20251028110326.png|300]]
![[Pasted image 20251028110730.png|250]]

PDU
应用层：用户数据，用户消息，报文
传输层：报文段segment 简称报文
网络层：分组或包packet
数据链路层：帧frame
物理层：位bit

协议是异系统同层间的规程
服务是同系统异层间的原语

### **参考模型**

#### OSI参考模型
OSI7层模型：应用层->表示层->会话层->传输层->网络层->数据链路层->物理层
缺点：层级太多，效率太低

#### TCP/IP参考模型
应用层->传输层->互联网层->网络接口层

#### 本教程内容的分层组织
应用层->传输层->网络层->数据链路层->物理层
ieee802+TCP/IP

### 计算机网络度量单位

比特率bit rate：bps
带宽：网络中某通道传送数据的能力，bit/s
	指的是一条数据链路理论上能够承载的最高数据传输速率
包转发率PPS：
时延：传输时延，传播时延，处理时延，排队时延
往返时延RTT
时延带宽积：时延带宽积=传播时延×带宽，即按比特计数的链路长度
吞吐量
有效吞吐量
利用率
丢包率
时延抖动：变化的时延
延迟丢包

在网络里kb到mb是十进制转换，在主机里是二进制转换
# 物理层

## 物理层基本概念
位置：网络体系结构中的最底层
	不是负责信号传输的具体物理媒介
	传输介质不属于物理层
	传输介质与设备之间的接口属于物理层

功能：如何连接各计算机的传输媒体上传输比特流
	数据链路层将数据比特流传送给物理层
	物理层将比特流按照传输媒体的需要进行编码
	然后将信号通过传输媒体传输到下一个节点的物理层

作用：尽可能地屏蔽掉不同传输媒体和通信手段地差异
	为数据链路层提供一个统一的数据传输服务

接口：
	数据终端设备DTE  ->用户设施
	数据电路终结设备DCE  ->交换机
标准化DTE/DCE接口特性
	机械特性
		涉及接口的物理结构，定义接口的形状尺寸，引线数量和排列等
	电气特性
		发送信号电平，发送器和接收器的输出阻抗，平衡特性等
	功能特性
		描述接口执行的功能，定义接线器每一引脚pin的作用
	过程特性（规程特性）
		指明对于不同功能的各种可能事件的出现顺序（通过引脚）

物理层协议是DTE和DCE之间的约定，规定两者之间的接口特性

## 传输介质
传输介质分类
	导引型传输介质（有线）
		双绞线
		同轴电缆
		光纤
			单模：带宽极宽，适用于大容量远距离通信
			多模
				多模突变光纤：带宽较窄
				多模渐变光纤：带宽较宽
		电力载波
	非导引型传输介质（无线）
		短波传输（无线电波）
		散射传输（无线电波）
		地面微波
			多路复用，射频工作，中继接力
			wifi前身
		光波传输

## 数据通信基础
### 傅里叶分析
在网络通信中，信号是以电磁信号的形式传输的
电磁信号是时间的函数
也可以表示成频率的函数
详细傅里叶分析见ppt

###  **奈魁斯特定理**
奈魁斯特定理推导的是无噪声有限带宽信道的最大数据传输率
- 最大数据传输率=$2 H \log_2 V \quad (\text{bps})$
- 任意信号通过一个带宽为H的低通滤波器，则每秒采样2H次就能完整地重现该信号，信号电平分为V级
### **香农定理**
把奈奎斯特的工作扩大到随机噪声干扰的情况
- 带宽为H赫兹，信噪比为$S/N$的任意信道最大数据传输率为$2H \log_2 (1+S/N)\quad (\text{bps})$
- 此式是利用信息论得出的，具有普遍意义
- 与电平级数，采样速度无关
- 此式仅是上限，难以达到

信息量：
根据香农定理，一条消息包含信息的多少为信息量
一条消息所载荷的信息量等于他所表示的事件发生的概率$p$的倒数的对数 $I=log_a\frac{1}p=-log_ap$（$a$表示进制，a=2单位为比特，a=e单位为奈特）
### 通信，消息，信息，数据，信号
通信：在源点与终点之间传递消息或者信息
消息：指能向人们表达客观物质运动与主观思维活动的文字符号数据等
	消息的特点
		能被通信双方所理解
		可以相互传递
信息：指包含在消息中对通信者有意义的那部分内容
	消息是信息的载体，消息中可能包含信息
数据：是对某一事实的不经解释并赋予一定含义的数字字母文字等符号和组合的原始表达
	数据是消息的一种表示形式，是传达某种意义或信息的实体
信号：信号是消息的载体（电信号，光信号等）

当信息被表示为数据时，数据中就包含了信息
信息可以通过解释数据来产生
### 传输方式
按时空顺序
	串行传输
	并行传输
按连接方式
	点到点传输
	点到多点传输
按数据信号在信道上传送方向与时间的关系
	单工
	半双工
	全双工
![[Pasted image 20250923120921.png|300]]
按发/收两端实现同步的方式
	异步传输
		被传输的每一个字符都附有1个起始位和1个停止位
		利用一个频率为传输比特率的n倍的时钟，在每个比特周期中心采样
	同步传输
		每个字符使用起止位按位传送，数据块以帧作为整体传输
		收发之间位同步
		每一帧建立同步标志，建立帧同步
按传输系统在传输数据信号过程中是否搬其频谱
	基带传输
	频带传输

### 数据编码技术
几种常见的编码技术
1. NRZ编码（不归零编码）
	- 逢1NRZ
	- 逢0NRZ
2. 曼彻斯特编码
3. 差分曼彻斯特编码

### 频带传输
三种调制技术
- 幅移键控法（调幅）
- 频移键控法（调频）
- 相移键控法（调相）

传输损伤
	误码error
	抖动jitter
	漂移wander
	滑动slip
	时延delay

### 性能度量
传输速率
	调制速率
	数据信号速率
	调制速率与数据信号速率的关系：波特率×码元信息承载量
。。。
## 多路复用技术
什么是复用技术：允许用户使用一个共享信道进行通讯

### 频分复用FDM
将多路基带信号调制到不同频率载波上，在进行叠加形成一个复合信号的多路复用技术

### 时分复用TDM
将时间划分为一段段等长的时分复用帧（TDM帧）
![[Pasted image 20250923151725.png]]

波分复用WMD
利用多个激光器在单条光纤上同时发送多束不同波长激光的技术
	OTN以WDM为基础，基本对象是波长级业务
	OTN与SDH不同
		SDH：帧长度不固定，每帧发送时长固定
		OTN：帧长度固定，每帧发送时长不固定

==**码分复用CDMA**==
利用码序列相关性实现的多址通信，基本思想是靠不同的地址码来区分的地址

正交频分复用OFDM
	选择相互正交的子载波
	用户的数据分成多个码流，每个码流用一个子载波发送

空分复用SDM


# 数据链路层
### 数据链路层在协议栈的位置
向下：利用物理层提供的位流服务
向上：向网络层提供明确的接口服务
## 数据链路层的功能
- 成帧 Framing
	将比特流划分成帧的主要目的是为了检测和纠正物理层在比特传输中可能出现的错误
- 差错控制 Error Control
- 流量控制 Flow Control

- 无确认无连接服务 unacknowledged connectionless
	接收方不对收到的帧进行确认
	eg.以太网
- 有确认有链接服务 acknowledged connectionless
	每一帧都得到单独确认
- 有确认有链接服务 acknowledged connection-oriented

### 成帧framing
成帧
	如何标识一个帧的开始
	成帧的方法
		字节计数法 byte count：用帧头的第一个字节表明帧长度的方法
		带字节填充的定界符法
			定界符flag：一个特殊的字节，用于区分前后两个不同的帧，eg：0x01111110
				flag | 头标 |  有效载荷  | 尾标 | flag  -> 一个帧
			发送发检查有效载荷，进行字节填充，将有效载荷里的特殊字符与flag区分
				A | flag | B  ->  A | ESC | flag | B
				A | ESC | B  ->  A | ESC | ESC | B
				A | ESC | FLAG | B  ->  A | ESC | ESC | ESC | FLAG | B
				A | ESC | ESC | B  ->  A | ESC | ESC | ESC | ESC | B
				...
			接受方的处理
				逐个检查收到的字符
				收到ESC
					后一个字节无条件成为有效载荷
				受到FLAG
					则为帧的边界
		带比特填充的定界符法
			定界符：两个0比特之间，连续6个1比特，即01111110，0x7E
				上一帧 | 01111110 | 下一帧
			发送方检查有效载荷
				若在有效载荷出现连续的5个1，则直接插入一个0
			接收方的处理
				若连续出现5个1
					若下一个比特为0，则为有效载荷，直接丢弃0比特
					若下一个比特为1，则连同后一比特的0，构成定界符，一帧结束

**物理层编码违例**
核心思想：把一种在正常数据流永远不会出现的信号/码字作为定界符
4B/5B编码方案
	4比特数据映射成5比特编码，剩余的一般码字（16个码字）未使用，可以作为帧定界符
	例如00110组合不包含在4B/5B编码中，可用作帧定界符
前导码
	存在很长的前导码preamble，可用作定界符
曼彻斯特编码/差分曼彻斯特编码
	正常信号在周期中间有跳变，持续的高电平为违例码，可用作定界符

### 差错控制
链路层存在的一个问题：信道的噪声导致数据传输问题
	差错
	丢失
	乱序
	重复
解决方案：差错检测与纠正，确认重传
	确认：接受方校验数据，并给发送方应答
	定时器：发送方启动定时器，防止丢失
	顺序号：接收方检查序号，防止乱序，重复

流量控制
链路层存在的另一个问题：接收方的处理速率
接收方的接收缓冲区溢出
解决方法：
	基于反馈feadback-based的流量控制
	基于速率rate-based的流量控制
		发送方内建机制，自行限速

## 差错检测与纠正
解决信道传输差错问题
	通常采用增加冗余信息（校验信息）的策略
	但是冗余信息太多了

两种主要策略
1. 检错码error-detecting code
	在被发送的数据块中，包含一些冗余信息，但这些信息只能使接收方推断是否发生错误，不能推断错误位置，接收方可申请重传
2. 纠错码error-correcting code
	在数据块中加入足够的冗余信息，是接受方可以判断错误位置
	使用纠错码的技术通常称为前向纠错FEC

### 码字 code word
一个包含m位数据位和r个校验位的n位单元
描述为（n，m）码，n=m+r

### 码率 code rate
码字中不含冗余部分所占的比例，可以用m/n表示

### 海明距离 Hamming distance
两个码字之间不同对应比特的数目
- 例：0000000000和0000011111的海明距离为5
- 如果两个码字的海明距离为d，则需要d个比特单位错就可以把一个码字转换为另一个码字
- 为了检查出d个错，可以使用海明距离为d+1的编码
- 为了纠正d个错，可以使用海明距离为2d+1的编码

### 常见的检错码包括
- 奇偶校验 Parity Check
- 校验和 Checksum
- 循环冗余校验 Cyclic Redundancy Check ，CRC

### 典型纠错码
- 海明码
- RS码（Read-Solomen code）

## 基本的数据链路层协议

物理层进程和某些数据链路层进程运行在专用硬件上（网络接口卡）
数据链路层进程的其他部分和网络链路层进程作为操作系统的一部分运行在CPU上，数据链路层进程的软件通常以设备驱动的形式存在

### 乌托邦式单工协议
结合pdu等内容理解ppt

### 无错信道的停等式协议

### 有错信道上的单工停等式协议

## 滑动窗口协议
停止-等待机制降低了信道利用率
解决方法：
### 滑动窗口协议
基本思想：
- 窗口机制：
	发送方和接收方都有一定容量的缓冲区（窗口），发送端在收到确认之前可以发送多帧
	窗口中是发送了还没确认的帧和允许发送但还没发送的帧
	滑动窗口可以控制流量
目的：对可以连续发送的最多帧数做限制
序号使用：循环使用有限的帧序号
流量控制：接收窗口驱动发送窗口的转动
	发送窗口
	接收窗口
发送窗口和接收窗口都为1的情况就是单工停等协议

### 回退N协议
#### 协议原理分析
思想
- 出错全部重发
	- 当接收端收到一个出错帧或乱序帧，丢弃所有的后续帧，并且不为这些帧发送确认
	- 发送端超时后，重传所有未被确认的帧
- 适用场景：接受窗口为1的情况，即只能按顺序接收帧

基本原理
- 当发送方发送了N个帧后，若发现该N帧的前一个帧在计时器超时后仍未返回其确认信息，则该帧被判为出错或丢失，此时发送方就重新发送出错帧及其后的N帧
- 滑动窗口长度：出错全部重发时，若帧序号为n位，接收窗口$W_R=1$，发送窗口$W_T\leq2^n-1$
![[Pasted image 20250930144327.png|500]]
####  协议实现分析
实现要点：必须增加序号范围，发送方需要缓存多个分组
两个窗口
	发送窗口
	接收窗口
发送方必须相应的三件事：
1. 上层的调用
2. 收到的ACK
3. 超时事件

实现的基本过程
1. 初始化
2. 等待时间的发生
3. 如果事件为网络层准备好，执行以下步骤
4. 如果事件为帧到达，则从物理层接收一个帧，则执行以下步骤
5. 如果事件是收到坏帧，继续执行步骤7
6. 如果事件是超时
7. 若发送窗口大小小于所允许的最大值

代码：
```C++
while(1) {
   wait_for_event(&event);
   switch(event){
       case network_layer_ready:
           from_network_layer(&buffer[next_frame_to_send]);
          nbuffered=nbuffered+1;
          send_data(next_frame_to_send, frame_expected, buffer);
          inc(next_frame_to_send);
          break;
case frame_arrival:
    from_physical_layer(&r);
    if(r.seq==frame_expected) {
        to_network_layer(&r.info);
        inc(frame_expected);
        }
    while(between(ack_expected, r.ack, net_frame_to_send)){
        nbuffered=nbuffered-1;
        stop_timer(ack_expected);
        inc(ack_expected);
        }
    break;
   case cksum_err: ；
       break;
   case timeout:
       next_frame_to_send=ack_expected;
       for(i=1; i<=nbuffered; i++){
           send_data(next_frame_to_send, frame_expected, buffer);
           inc(next_frame_to_send);
           }
   }
   if(nbuffered<MAX_SEQ) 
       enable_network_layer();
   else 
       disable_network_layer();
 }
```
### 选择重传协议
#### 协议设计思想
设计思想
	若发送方发出连续的若干帧后，收到对其中某一帧的否认帧，或某一帧的定时器超时，则只重传该出错帧或计时器超时的数据帧
基本原理

### PPP
# 介质访问子层（MAC子层）
数据链路分为两个子层
	MAC子层：介质访问
	LLC子层：承上启下

# 网路层


# 传输层


# 应用层


# 网络安全


# 新型网络

